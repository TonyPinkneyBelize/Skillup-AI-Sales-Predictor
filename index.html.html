<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Sales Predictor Pro</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --dark: #212529;
            --light: #f8f9fa;
            --success: #4cc9f0;
            --danger: #f72585;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: #f5f7ff;
            padding: 20px;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 24px;
        }

        .panel {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 24px;
            margin-bottom: 24px;
        }

        .panel-header {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }

        .panel-header svg {
            margin-right: 8px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 16px;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: var(--light);
            color: var(--dark);
            border: 1px solid #dee2e6;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dee2e6;
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: border 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent);
        }

        .data-preview {
            height: 200px;
            overflow: auto;
            border: 1px solid #dee2e6;
            border-radius: var(--border-radius);
            padding: 12px;
            margin-top: 12px;
            background-color: #f8f9fa;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .feature-list {
            max-height: 200px;
            overflow-y: auto;
            margin: 12px 0;
            border: 1px solid #dee2e6;
            border-radius: var(--border-radius);
            padding: 8px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .feature-item:last-child {
            border-bottom: none;
        }

        .prediction-result {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary);
            margin-top: 16px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            text-align: center;
        }

        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="loadingOverlay">
        <div class="spinner"></div>
        <h2>Loading AI Environment...</h2>
        <p>This may take 20-30 seconds on first load</p>
    </div>

    <div class="app-container">
        <!-- Left Sidebar -->
        <div>
            <!-- Data Input Panel -->
            <div class="panel">
                <div class="panel-header">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Data Input
                </div>
                <input type="file" id="csvFile" class="form-control" accept=".csv">
                <button id="loadDataBtn" class="btn btn-primary" style="margin-top: 12px;">
                    Load Data
                </button>
                <div id="dataPreview" class="data-preview"></div>
            </div>

            <!-- Model Configuration Panel -->
            <div class="panel">
                <div class="panel-header">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v4"></path>
                        <path d="M5 10v4a7 7 0 0 0 7 7v0a7 7 0 0 0 7-7v-4"></path>
                        <path d="M5 10h14"></path>
                        <path d="M12 15v6"></path>
                    </svg>
                    Model Configuration
                </div>
                
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">Target Variable</label>
                <select id="targetVar" class="form-control" disabled>
                    <option>Select target...</option>
                </select>
                
                <label style="display: block; margin-top: 16px; margin-bottom: 8px; font-weight: 500;">Features</label>
                <select id="featureDropdown" class="form-control" disabled>
                    <option>Select feature...</option>
                </select>
                
                <div style="display: flex; gap: 8px; margin-top: 8px;">
                    <button id="addFeatureBtn" class="btn btn-secondary" disabled>Add Feature</button>
                    <button id="removeFeatureBtn" class="btn btn-secondary" disabled>Remove</button>
                </div>
                
                <div id="featuresList" class="feature-list"></div>
                
                <label style="display: block; margin-top: 16px; margin-bottom: 8px; font-weight: 500;">Model Type</label>
                <select id="modelType" class="form-control">
                    <option value="rf">Random Forest</option>
                    <option value="xgb">XGBoost</option>
                    <option value="lr">Linear Regression</option>
                </select>
                
                <div style="margin-top: 16px;">
                    <input type="checkbox" id="tuneCheckbox">
                    <label for="tuneCheckbox">Enable Hyperparameter Tuning</label>
                </div>
                
                <div style="margin-top: 8px;">
                    <input type="checkbox" id="logCheckbox">
                    <label for="logCheckbox">Log Transform Target</label>
                </div>
                
                <button id="trainModelBtn" class="btn btn-primary" style="margin-top: 16px; width: 100%;" disabled>
                    Train Model
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div>
            <!-- Prediction Panel -->
            <div class="panel">
                <div class="panel-header">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                    </svg>
                    Make Predictions
                </div>
                <div id="predictionInputs"></div>
                <button id="predictBtn" class="btn btn-primary" style="margin-top: 16px;" disabled>
                    Predict
                </button>
                <div id="predictionResult" class="prediction-result">
                    Prediction will appear here
                </div>
            </div>

            <!-- Results Panel -->
            <div class="panel">
                <div class="panel-header">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="4 17 10 11 4 5"></polyline>
                        <line x1="12" y1="19" x2="20" y2="19"></line>
                    </svg>
                    Model Results
                </div>
                <pre id="resultsText" style="white-space: pre-wrap; padding: 12px; background: #f8f9fa; border-radius: var(--border-radius);"></pre>
            </div>

            <!-- Visualization Panel -->
            <div class="panel">
                <div class="panel-header">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    Performance Visualization
                </div>
                <canvas id="resultsChart"></canvas>
            </div>
        </div>
    </div>

    <script>
    // Main application controller
    class SalesPredictorApp {
        constructor() {
            this.pyodide = null;
            this.df = null;
            this.model = null;
            this.selectedFeatures = [];
            this.target = null;
            this.logTransform = false;
            
            this.initUI();
            this.loadPyodide();
        }
        
        initUI() {
            // Connect all UI elements
            document.getElementById('loadDataBtn').addEventListener('click', () => this.handleLoadData());
            document.getElementById('addFeatureBtn').addEventListener('click', () => this.addFeature());
            document.getElementById('removeFeatureBtn').addEventListener('click', () => this.removeFeature());
            document.getElementById('trainModelBtn').addEventListener('click', () => this.trainModel());
            document.getElementById('predictBtn').addEventListener('click', () => this.makePrediction());
        }
        
        async loadPyodide() {
            this.pyodide = await loadPyodide({
                indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/"
            });
            
            await this.pyodide.loadPackage(["pandas", "scikit-learn", "xgboost", "matplotlib"]);
            
            // Inject Python code
            await this.pyodide.runPython(`
                # Your Python ML code here
                import pandas as pd
                import numpy as np
                from sklearn.compose import ColumnTransformer
                from sklearn.pipeline import Pipeline
                from sklearn.preprocessing import StandardScaler, OneHotEncoder
                from sklearn.ensemble import RandomForestRegressor
                from sklearn.metrics import mean_absolute_error, r2_score, mean_squared_error
                from sklearn.model_selection import train_test_split, GridSearchCV
                from sklearn.linear_model import LinearRegression
                import xgboost as xgb
                
                # ... (Your full Python implementation) ...
            `);
            
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        async handleLoadData() {
            const fileInput = document.getElementById('csvFile');
            if (fileInput.files.length === 0) return;
            
            const file = fileInput.files[0];
            const text = await file.text();
            
            // Process CSV and update UI
            await this.pyodide.runPython(`df = pd.read_csv(StringIO("""${text}"""))`);
            this.updateVariableSelection();
            
            // Show preview
            const preview = await this.pyodide.runPython(`df.head().to_string()`);
            document.getElementById('dataPreview').textContent = preview;
        }
        
        // ... (All other methods implemented similarly) ...
    }

    // Start the application
    new SalesPredictorApp();
    </script>
</body>
</html>